v2:~"v"(begin ~(bind @bold &" nex|v"(~(bind @style-list ~(parse-style ~(get-style-from @nex))) ~(bind @new-style-list ~(set-style $"font-weight" $"bold" @style-list)) ~(apply-style-to ~(join-style @new-style-list) @nex))) ~(bind @italic &" nex|v"(~(bind @stylestring ~(get-style-from @nex)) ~(bind @newstylestring ~(add-style $"font-style" $"italic" @stylestring)) ~(apply-style-to @newstylestring @nex))) ~(bind @parse-style &" stylestring|v"(~(bind @stylelist ~(string-split @stylestring $";")) ~(bind @split-pairs &" lst|v"(~"v"(if ~(is-empty @lst) [word]() ~"v"(begin ~(bind @pair ~(string-split ~(car @lst) $":")) ~"v"(cons @pair ~(split-pairs ~(cdr @lst))))))) ~(split-pairs @stylelist))) ~(bind @join-style &" stylelist|v"(~"v"(if ~(is-empty @stylelist) $ ~"v"(begin ~(bind @pair ~(car @stylelist)) ~(bind @pairstring ~"v"(string-cat ~(car @pair) ~(car ~(cdr @pair)))) ~"v"(string-cat @pairstring ~"v"(join-style ~(cdr @stylelist))))))) ~(bind @add-style &" stylename styleval stylelist|v"(~"v"(if ~(has-style @stylename @stylelist) @str ~(string-cat @stylename $":" @styleval ~(if ~(string-eq @str $) $ $";") @str)))) ~(bind @remove-style &" stylename stylelist|v"()) ~(bind @has-style &" stylename stylelist|v"(~"v"(if ~(is-empty @stylelist) !no ~"v"(begin ~(bind @style ~(car @stylelist)) ~(bind @pair ~(string-split @style $":")) ~(bind @name ~(car @pair)) ~"v"(if ~(string-eq @stylename @name) !yes ~(has-style @stylename ~(cdr @stylelist))))))) ~(bind @string-substr &" str start len pos|v"(~"v"(if ~(::eq:: @pos ~(::pl:: @start @len)) $ ~"v"(if ~(::gte:: @pos @start) ~"v"(string-cat ~(string-char-at @str @pos) ~(string-substr @str @start @len ~(::pl:: @pos #1))) ~(string-substr @str @start @len ~(::pl:: @pos #1)))))) ~(bind @string-split &" str on|v"(~"v"(begin ~(bind @first-index-of ~(string-index-of @str @on)) ~"v"(if ~(is-error @first-index-of) ~(if ~(string-eq @str $) [word]() ~(cons @str [word]())) ~"v"(cons ~"v"(string-substr @str #0 @first-index-of #0) ~"v"(string-split ~"v"(string-substr @str ~(::pl:: @first-index-of #1) ~(- ~(string-length @str) ~(::pl:: @first-index-of #1)) #0) @on)))))))