~"begin"v(~"bind"h(@bold &" nex"v(~"bind"h(@style-list ~"parse-style"h(~"get-style-from"h(@nex~)~)~) ~"bind"h(@new-style-list ~"set-style"h($"font-weight" $"bold" @style-list~)~) ~"apply-style-to"h(~"join-style"h(@new-style-list~) @nex~)&)~) ~"bind"h(@italic &" nex"v(~"bind"h(@stylestring ~"get-style-from"h(@nex~)~) ~"bind"h(@newstylestring ~"add-style"h($"font-style" $"italic" @stylestring~)~) ~"apply-style-to"h(@newstylestring @nex~)&)~) ~"bind"h(@parse-style &" stylestring"v(~"bind"h(@stylelist ~"string-split"h(@stylestring $";"~)~) ~"bind"h(@split-pairs &" lst"v(~"if"v(~"is-empty"h(@lst~) () ~"begin"v(~"bind"h(@pair ~"string-split"h(~"car"h(@lst~) $":"~)~) ~"cons"v(@pair ~"split-pairs"h(~"cdr"h(@lst~)~)~)~)~)&)~) ~"split-pairs"h(@stylelist~)&)~) ~"bind"h(@join-style &" stylelist"v(~"if"v(~"is-empty"h(@stylelist~) $"" ~"begin"v(~"bind"h(@pair ~"car"h(@stylelist~)~) ~"bind"h(@pairstring ~"string-cat"v(~"car"h(@pair~) ~"car"h(~"cdr"h(@pair~)~)~)~) ~"string-cat"v(@pairstring ~"join-style"v(~"cdr"h(@stylelist~)~)~)~)~)&)~) ~"bind"h(@add-style &" stylename styleval stylelist"v(~"if"v(~"has-style"h(@stylename @stylelist~) @str ~"string-cat"h(@stylename $":" @styleval ~"if"h(~"string-eq"h(@str $""~) $"" $";"~) @str~)~)&)~) ~"bind"h(@remove-style &" stylename stylelist"v(&)~) ~"bind"h(@has-style &" stylename stylelist"v(~"if"v(~"is-empty"h(@stylelist~) !no ~"begin"v(~"bind"h(@style ~"car"h(@stylelist~)~) ~"bind"h(@pair ~"string-split"h(@style $":"~)~) ~"bind"h(@name ~"car"h(@pair~)~) ~"if"v(~"string-eq"h(@stylename @name~) !yes ~"has-style"h(@stylename ~"cdr"h(@stylelist~)~)~)~)~)&)~) ~"bind"h(@string-substr &" str start len pos"v(~"if"v(~"="h(@pos ~"+"h(@start @len~)~) $"" ~"if"v(~">="h(@pos @start~) ~"string-cat"v(~"string-char-at"h(@str @pos~) ~"string-substr"h(@str @start @len ~"+"h(@pos #1~)~)~) ~"string-substr"h(@str @start @len ~"+"h(@pos #1~)~)~)~)&)~) ~"bind"h(@string-split &" str on"v(~"begin"v(~"bind"h(@first-index-of ~"string-index-of"h(@str @on~)~) ~"if"v(~"is-error"h(@first-index-of~) ~"if"h(~"string-eq"h(@str $""~) () ~"cons"h(@str ()~)~) ~"cons"v(~"string-substr"v(@str #0 @first-index-of #0~) ~"string-split"v(~"string-substr"v(@str ~"+"h(@first-index-of #1~) ~"-"h(~"string-length"h(@str~) ~"+"h(@first-index-of #1~)~) #0~) @on~)~)~)~)&)~)~)