~"begin"v( ~"import"h( @style-functions~) ~"import"h( @util-functions~) ~"bind"h( @justify-doc &" doc size"v( ~"let"h( @newdoc {}~) ~"do-for-each"h( &" line"v( ~"let"h( @f ~"font"h( ~"light"h( ~"flatten"h( @line~)~) $"Helvetica"~)~) ~"set"h( @newdoc ~"cons"h( ~"resize-to-target"h( @f @size~) @newdoc~)~)&) @doc~) @newdoc&)~) ~"bind"h( @resize-to-target &" phrase target"v( ~"let"h( @size ~"find-best-font"h( @phrase @target~)~) ~"text-size"h( @phrase @size~)&)~) ~"bind"h( @do-for-each &" f lst"v( ~"if"v( ~"is-empty"h( @lst~) () ~"cons"h( ~""h( @f ~"car"h( @lst~)~) ~"do-for-each"h( @f ~"cdr"h( @lst~)~)~)~)&)~) ~"bind"h( @range &" start end"v( ~"if"v( ~">"h( @start @end~) () ~"cons"h( @start ~"range"h( ~"+"h( @start #1~) @end~)~)~)&)~) ~"bind"h( @make-width-lookup &" list"v( ~"if"v( ~"is-empty"h( @list~) () ~"begin"v( ~"let"h( @first ~"car"h( @list~)~) ~"let"h( @width ~"run-js"h( $"$dom[0].getBoundingClientRect().width" @first~)~) ~"cons"h( ~"cons"h( @first ~"cons"h( @width ()~)~) ~"make-width-lookup"h( ~"cdr"h( @list~)~)~)~)~)&)~) ~"bind"h( @lookup &" nex table"v( ~"let"h( @r ^~) ~"do-for-each"h( &" entry"v( ~"let"h( @key ~"car"h( @entry~)~) ~"if"v( ~"equal"h( @key @nex~) ~"set"h( @r ~"car"h( ~"cdr"h( @entry~)~)~) ^~)&) @table~) @r&)~) ~"bind"h( @total-in-font &" phrase font-list-entry"v( ~"let"h( @lookup-table ~"car"h( ~"cdr"h( @font-list-entry~)~)~) ~"let"h( @sum #0~) ~"do-for-each"h( &" letter"v( ~"let"h( @width ~"lookup"h( @letter @lookup-table~)~) ~"if"v( ~"equal"h( @width ^~) ^ ~"set"h( @sum ~"+"h( @sum @width~)~)~)&) @phrase~) @sum&)~) ~"bind"h( @calculate-all-widths &" phrase all-lookups"v( ~"do-for-each"h( &" lookup"v( ~"let"h( @font ~"car"h( @lookup~)~) ~"let"h( @total ~"total-in-font"h( @phrase @lookup~)~) ~"cons"h( @font ~"cons"h( @total ()~)~)&) @all-lookups~)&)~) ~"bind"h( @find-best-font &" phrase targetwidth"v( ~"let"h( @widthmap ~"calculate-all-widths"h( @phrase @lettermap~)~) ~"let"h( @best ~"car"h( ~"car"h( @widthmap~)~)~) ~"let"h( @find-it &" target prevsize map"v( ~"if"v( ~"is-empty"h( @map~) @prevsize ~"begin"v( ~"let"h( @mapentry ~"car"h( @map~)~) ~"let"h( @fontsize ~"car"h( @mapentry~)~) ~"let"h( @width-in-font ~"car"h( ~"cdr"h( @mapentry~)~)~) ~"if"v( ~">"h( @width-in-font @target~) @prevsize ~"find-it"h( @target @fontsize ~"cdr"h( @map~)~)~)~)~)&)~) ~"find-it"h( @targetwidth @best @widthmap~)&)~) { { [ ( |(d)| |(o)|) |( )| ( |(t)| |(h)| |(e)|) |( )| ( |(f)| |(o)| |(l)| |(l)| |(o)| |(w)| |(i)| |(n)| |(g)|) |( )| ( |(t)| |(h)| |(i)| |(n)| |(g)|) |( )| ( |(f)| |(i)| |(r)| |(s)| |(t)|) |(-)| |( )| ( |(r)| |(e)| |(t)| |(r)| |(i)| |(e)| |(v)| |(i)| |(n)| |(g)|) |( )| ( |(t)| |(h)| |(e)|) |( )| ( |(f)| |(o)| |(n)| |(t)|) |( )| ( |(s)| |(i)| |(z)| |(e)|) |( )| ( |(d)| |(o)| |(e)| |(s)| |(n)| |(')| |(t)|) |( )| ( |(w)| |(o)| |(r)| |(k)|) |( )| ( |(u)| |(n)| |(t)| |(i)| |(l)|) |( )| ( |(i)| |(t)| |(')| |(s)|) |( )| ( |(b)| |(e)| |(e)| |(n)|)] [ |[&nbsp;]| ( |(r)| |(e)| |(n)| |(d)| |(e)| |(r)| |(e)| |(d)|) |( )| ( |(o)| |(n)|) |( )| ( |(t)| |(h)| |(e)|) |( )| ( |(s)| |(c)| |(r)| |(e)| |(e)| |(n)|) |( )| |( )| |(-)| |( )| ( |(l)| |(o)| |(o)| |(k)| |(i)| |(n)| |(g)|) |( )| ( |(t)| |(o)|) |( )| ( |(f)| |(i)| |(x)|) |( )| ( |(t)| |(h)| |(i)| |(s)|) |(-)| |( )| ( |(t)| |(h)| |(e)| |(n)|) |( )| ( |(p)| |(a)| |(s)| |(t)| |(e)|) |( )| ( |(i)| |(n)|) |( )| ( |(t)| |(h)| |(e)|) |( )| ( |(b)| |(i)| |(n)| |(d)|) |( )| ( |(e)| |(x)| |(p)| |(r)|) |( )| ( |(b)| |(e)| |(l)| |(o)| |(w)|) |(.)|]} ~"do-for-each"h( &" n"v( ~"cons"h( @n ~"cons"h( ~"font"h( ~"light"h( ~"text-size"h( ( |(A)| |(B)| |(C)| |(D)| |(E)| |(F)| |(G)| |(H)| |(I)| |(J)| |(K)| |(L)| |(M)| |(N)| |(O)| |(P)| |(Q)| |(R)| |(S)| |(T)| |(U)| |(V)| |(W)| |(X)| |(Y)| |(Z)| |( )| |(;)| |(,)| |(:)| |(?)| |(')| |(")| |(.)| |(,)| |(a)| |(b)| |(c)| |(d)| |(e)| |(f)| |(g)| |(h)| |(i)| |(j)| |(k)| |(l)| |(m)| |(n)| |(o)| |(p)| |(q)| |(r)| |(s)| |(t)| |(u)| |(v)| |(w)| |(x)| |(y)| |(z)|) @n~)~) $"Helvetica"~) ()~)~)&) ~"range"h( #8 #40~)~) ~"bind"h( @lettermap ~"do-for-each"h( &" item"v( ~"let"h( @list ~"car"h( ~"cdr"h( @item~)~)~) ~"let"h( @size ~"car"h( @item~)~) ~"cons"h( @size ~"cons"h( ~"make-width-lookup"h( @list~) ()~)~)&) { [ ( |(i)| |(t)| |(e)| |(m)| |(s)|) |( )| ( |(h)| |(e)| |(r)| |(e)|)]}~)~)}~)