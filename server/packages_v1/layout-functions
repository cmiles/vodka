~"package"v( @layout ~"import"h( @util-functions~) ~"import"h( @style-functions~) ~"bind"h( @scale-to-pixel-width &" n width"v( ~"let"h( @defaultsize #50~) ~"let"h( @infont ~"style:with-text-in-size"h( @n @defaultsize~)~) ~"let"h( @widthindefaultfont ~"get-pixel-width"h( @infont~)~) ~"let"h( @heightindefaultfont ~"get-pixel-height"h( @infont~)~) ~"let"h( @ratio ~"/"h( ~"to-float"h( @width~) ~"to-float"h( @widthindefaultfont~)~)~) ~"let"h( @containerheight ~"*"h( @ratio ~"to-float"h( @heightindefaultfont~)~)~) ~"cons"v( ~"style:with-transform-origin-x-y"h( ~"style:with-scale"h( @infont @ratio~) %0.0 %0.0~) ~"style:with-height-of"h( [] @containerheight~)~)&)~) ~"bind"h( @justify-doc-to-width-in-format-by-line &" doc sizelimit format"v( ~"map-with"v( @doc &" line"v( ~"let"h( @formattedline ~"format"h( @line~)~) ~"let"h( @widthat50 ~"get-pixel-width"h( ~"style:with-text-in-size"h( @formattedline #50~)~)~) ~"let"h( @desiredpixelsize ~"to-integer"h( ~"*"h( %50 ~"/"h( ~"to-float"h( @sizelimit~) @widthat50~)~)~)~) ~"style:with-text-in-size"h( @formattedline @desiredpixelsize~)&)~)&)~) ~"bind"h( @justify-doc-to-width-in-format &" doc sizelimit format"v( ~"map-with"v( @doc &" line"v( ~"let"h( @formattedline ~"do-for-each-letter-or-separator-in"h( &" letter"v( ~"format"h( @letter~)&) @line~)~) ~"let"h( @widthat50 ~"get-pixel-width"h( ~"style:with-text-in-size"h( @formattedline #50~)~)~) ~"let"h( @desiredpixelsize ~"to-integer"h( ~"*"h( %50 ~"/"h( ~"to-float"h( @sizelimit~) @widthat50~)~)~)~) ~"do-for-each-letter-or-separator-in"h( &" letter"v( ~"style:with-text-in-size"v( @letter @desiredpixelsize~)&) @formattedline~)&)~)&)~) ~"bind"h( @doc-with-contents-of &" lst"v( ~"util:put-contents-in"h( @lst {}~)&)~) ~"bind"h( @with-only-words &" lst"v( ~"util:with-only-items-satisfying"h( @lst @is-word~)&)~) ~"bind"h( @combine-lines &" doc"v( ~"if"v( ~"is-empty"h( @doc~) [] ~"util:list-cat"h( ~"car"h( @doc~) ~"combine-lines"h( ~"cdr"h( @doc~)~)~)~)&)~) ~"bind"h( @flatten-lines &" doc"v( ~"map"v( @doc &" line"v( ~"util:flatten"h( @line~)&)~)&)~) ~"bind"h( @do-for-each-line-in &" f doc"v( ~"util:traverse-items-satisfying-and-do"v( @doc &" n"v( ~"is-line"h( @n~)&) @f~)&)~) ~"bind"h( @do-for-each-word-in &" f doc"v( ~"util:traverse-items-satisfying-and-do"v( @doc &" n"v( ~"is-word"h( @n~)&) @f~)&)~) ~"bind"h( @do-for-each-letter-in &" f doc"v( ~"util:traverse-items-satisfying-and-do"v( @doc &" n"v( ~"is-letter"h( @n~)&) @f~)&)~) ~"bind"h( @do-for-each-letter-or-separator-in &" f doc"v( ~"util:traverse-items-satisfying-and-do"v( @doc &" n"v( ~"or"v( ~"is-letter"h( @n~) ~"is-separator"h( @n~)~)&) @f~)&)~) ~"bind"h( @do-for-each-expectation-in &" f doc"v( ~"util:traverse-items-satisfying-and-do"v( @doc &" n"v( ~"is-expectation"h( @n~)&) @f~)&)~) ~"bind"h( @top-mask-nex-by &" n amount"v( ~"let"h( @nexheight ~"get-pixel-height"h( @n~)~) ~"let"h( @nexwidth ~"get-pixel-width"h( @n~)~) ~"let"h( @maskheight ~"*"h( @amount @nexheight~)~) ~"cons"h( @n ~"style:clips-contents"h( ~"style:with-width-of"h( ~"style:with-height-of"h( () @maskheight~) @nexwidth~)~)~)&)~)~)